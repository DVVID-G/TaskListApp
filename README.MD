# Recuperaci√≥n de Contrase√±a

Este proyecto implementa un flujo seguro de recuperaci√≥n y restablecimiento de contrase√±a para usuarios registrados.

---

## üõ†Ô∏è Flujo de recuperaci√≥n

### 1. Solicitud de recuperaci√≥n

- El usuario accede a `/forgot-password` y env√≠a su correo electr√≥nico.
- El backend responde siempre con **HTTP 202 (Accepted)**, sin indicar si el correo existe.
- Si el correo est√° registrado, se genera un token seguro de un solo uso, v√°lido por 1 hora, y se env√≠a un correo con un enlace de restablecimiento.

### 2. Recepci√≥n del enlace

- El usuario recibe un correo (usando **Mailtrap** en desarrollo) con un enlace similar a:

https://<FRONTEND_URL>/reset?token=EL_TOKEN_GENERADO

- El enlace contiene el token de recuperaci√≥n.

### 3. Restablecimiento de contrase√±a

- El usuario accede al enlace y es dirigido a un formulario donde debe ingresar una nueva contrase√±a y confirmarla.
- El frontend env√≠a una petici√≥n **POST** a `/reset-password` con el token, la nueva contrase√±a y la confirmaci√≥n.

### 4. Validaciones

El backend verifica:
- Que el token sea v√°lido y no haya expirado.
- Que la contrase√±a cumpla con los requisitos de seguridad (m√≠nimo 8 caracteres, may√∫scula, min√∫scula y n√∫mero).
- Que la confirmaci√≥n coincida.

Si todo es correcto:
- Se actualiza la contrase√±a (hasheada con bcrypt).
- El token se invalida inmediatamente.
- Se responde con **HTTP 200** y mensaje de √©xito.

Si el token es inv√°lido o expir√≥, se responde con un mensaje de error.

### 5. Manejo de errores

- Si el correo no est√° registrado, la respuesta es siempre **202 (Accepted)** para no filtrar cuentas.
- Errores internos retornan un mensaje gen√©rico: `"Int√©ntalo de nuevo m√°s tarde"`.

---

## üì° Endpoints involucrados

- `POST /api/v1/auth/forgot-password`
- **Body:**  
  ```json
  { "email": "usuario@correo.com" }
  ```
- `POST /api/v1/auth/reset-password`
- **Body:**  
  ```json
  { "token": "EL_TOKEN_GENERADO", "password": "NuevaContrase√±a123", "confirmPassword": "NuevaContrase√±a123" }
  ```

---

## üí° Notas

- El correo de recuperaci√≥n se env√≠a usando **Mailtrap** en desarrollo.
- El enlace de recuperaci√≥n solo puede usarse una vez y expira en 1 hora.
- Los mensajes de error est√°n dise√±ados para ser accesibles y no revelar informaci√≥n sensible.

---

## üß™ Ejemplo de petici√≥n con curl

**Solicitud de recuperaci√≥n:**
```bash
curl -X POST http://localhost:3000/api/v1/auth/forgot-password \
-H "Content-Type: application/json" \
-d '{"email":"usuario@correo.com"}'

Restablecimiento de contrase√±a:

curl -X POST http://localhost:3000/api/v1/auth/reset-password 
-H "Content-Type: application/json"
-d '{"token":"EL_TOKEN_GENERADO","password":"NuevaContrase√±a123","confirmPassword":"NuevaContrase√±a123"}'